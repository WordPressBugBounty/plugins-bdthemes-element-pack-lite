(()=>{"use strict";class t{constructor(t,e,i){this.element=t,this.settings=e,this.isEditMode=i,this.widgetId=e.widgetId,this.abortController=new AbortController,this.signal=this.abortController.signal}setLocalize(){if(this.isEditMode)return void this.clearLocalize();this.clearLocalize();const t=60*this.settings.displayTimesExpire*60,e=Date.now()+1e3*t;if(null===localStorage.getItem(this.widgetId)&&(localStorage.setItem(this.widgetId,"0"),localStorage.setItem(`${this.widgetId}_expiresIn`,e.toString())),null!==localStorage.getItem(this.widgetId)){let t=parseInt(localStorage.getItem(this.widgetId))||0;t++,localStorage.setItem(this.widgetId,t.toString())}}clearLocalize(){const t=parseInt(localStorage.getItem(`${this.widgetId}_expiresIn`));Date.now()>=t&&(localStorage.removeItem(`${this.widgetId}_expiresIn`),localStorage.removeItem(this.widgetId))}modalFire(){const t=this.settings.displayTimes||1,e=parseInt(localStorage.getItem(this.widgetId))||0;!1!==t&&e>=t||window.bdtUIkit?.modal&&window.bdtUIkit.modal(this.element,{bgclose:!1,keyboard:!1}).show()}setupAgeVerify(){let t=parseInt(localStorage.getItem(this.widgetId))||0;const e=this.element,i=e.querySelectorAll(".bdt-button"),o=!this.isEditMode&&this.settings.redirect_link;let s=this.settings.requiredAge;i.forEach((i=>{i.addEventListener("click",(()=>{const n=e.querySelector(".bdt-age-input");let l=parseInt(n?.value)||0;if(i.classList.contains("data-val-yes")&&(l=18),i.classList.contains("data-val-no")&&(s=18,l=1),l>=s)this.setLocalize(),t+=1,window.bdtUIkit?.modal&&window.bdtUIkit.modal(this.element).hide();else{const t=document.querySelector(".modal-msg-text");t&&t.classList.remove("bdt-hidden"),!1!==o&&window.location.replace(o)}}),{signal:this.signal})})),window.bdtUIkit?.util&&window.bdtUIkit.util.on(this.element,"hidden",(()=>{this.isEditMode||(!1===o&&t<=0?setTimeout((()=>{this.modalFire()}),1500):!1!==o&&t<=0&&window.location.replace(o))}))}setupCloseBtnDelay(){const{id:t,delayTime:e}=this.settings,i=document.getElementById(t);if(!i)return;const o=i.querySelector("#bdt-modal-close-button");o&&(o.style.display="none",window.bdtUIkit?.util&&(window.bdtUIkit.util.on(i,"shown",(()=>{o.style.display="none",setTimeout((()=>{o.style.display="",o.style.opacity="0",o.style.transition="opacity 0.3s",setTimeout((()=>{o.style.opacity="1"}),10)}),e)})),window.bdtUIkit.util.on(i,"hide",(()=>{o.style.display="none"}))))}init(){this.modalFire(),this.setupAgeVerify(),this.settings.closeBtnDelayShow&&this.setupCloseBtnDelay()}destroy(){this.abortController.abort()}}const e=e=>{const i=(e instanceof jQuery?e[0]:e).querySelectorAll(".bdt-age-gate");if(0===i.length)return;const o=Boolean(window.elementorFrontend?.isEditMode());i.forEach((e=>{const i=e.dataset.settings;if(!i)return;let s;try{s="string"==typeof i?JSON.parse(i):i}catch(t){return void console.error("Failed to parse age gate settings:",t)}const n=new t(e,s,o);n.init(),e._ageGateInstance=n}))};window.addEventListener("elementor/frontend/init",(()=>{window.elementorFrontend?.hooks&&elementorFrontend.hooks.addAction("frontend/element_ready/bdt-age-gate.default",e)}))})();