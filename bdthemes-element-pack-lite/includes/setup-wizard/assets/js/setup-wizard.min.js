!function(t){async function e(e,s){try{return(await new Promise(((i,n)=>{t.ajax({url:BDT_SetupWizard.ajax_url,type:"POST",data:{action:"import_ep_elementor_bundle_runner_template",nonce:BDT_SetupWizard.nonce,sessionId:e,runner:s},success:i,error:n})}))).success}catch(t){return console.error("AJAX Error:",t),!1}}t(".bdt-setup-wizard").length&&(t(document).ready((function(){({currentStep:0,steps:document.querySelectorAll(".bdt-wizard-step"),nextButtons:document.querySelectorAll(".bdt-wizard-next"),prevButtons:document.querySelectorAll(".bdt-wizard-prev"),progressItems:document.querySelectorAll(".bdt-wizard-progress-item"),progressBar:document.getElementById("plugin-install-progress"),categorySelect:document.getElementById("category-select"),searchInput:document.querySelector(".widget-search"),activateAllButton:document.querySelector(".bulk-action.activate"),deactivateAllButton:document.querySelector(".bulk-action.deactivate"),saveButton:document.getElementById("save-and-continue"),widgetList:document.querySelector(".widget-list"),installButton:document.getElementById("ep-install-plugins-btn"),filterButtons:document.querySelectorAll(".filter-button"),init:function(){this.setupStepAttributes(),this.showStep(this.currentStep),this.updateProgress(this.currentStep),this.bindEvents(),this.initAnimations()},setupStepAttributes:function(){const t=["welcome","features","integration","finish"];this.steps.forEach(((e,s)=>{!e.hasAttribute("data-step")&&s<t.length&&e.setAttribute("data-step",t[s])}))},initAnimations:function(){const t=this.steps[this.currentStep];t&&setTimeout((()=>{t.classList.add("active"),t.style.display="block"}),100)},bindEvents:function(){const e=this;this.progressItems.forEach(((t,e)=>{t.addEventListener("click",(()=>{t.getAttribute("data-step");e<=this.getCompletedStepIndex()&&this.goToStep(e)}))})),t(document).on("click",".bdt-wizard-next",(function(s){s.preventDefault();const i=t(this).data("step");if(i){for(let s=0;s<e.steps.length;s++)if(t(e.steps[s]).data("step")===i)return void e.goToStep(s);const s=e.getStepIndexByName(i);if(-1!==s)return void e.goToStep(s)}e.goToStep(e.currentStep+1)})),this.prevButtons.forEach((t=>{t.addEventListener("click",(()=>{const e=t.getAttribute("data-step");if(e){const t=this.getStepIndexByName(e);-1!==t&&this.goToStep(t)}else this.currentStep>0&&this.goToStep(this.currentStep-1)}))})),this.filterButtons&&this.filterButtons.forEach((t=>{t.addEventListener("click",(()=>{this.filterButtons.forEach((t=>t.classList.remove("active"))),t.classList.add("active"),this.filterItemsByType(t.dataset.filter)}))})),this.categorySelect&&this.categorySelect.addEventListener("change",this.filterWidgets.bind(this)),this.searchInput&&(this.searchInput.addEventListener("input",this.searchWidgets.bind(this)),this.searchInput.addEventListener("keydown",(function(t){"Enter"===t.key&&t.preventDefault()}))),this.activateAllButton&&this.activateAllButton.addEventListener("click",this.activateAllWidgets.bind(this)),this.deactivateAllButton&&this.deactivateAllButton.addEventListener("click",this.deactivateAllWidgets.bind(this)),this.saveSettingsSubmit(),this.installPlugins(),this.onChangedPluginSliderCheckbox();document.querySelectorAll(".bdt-feature-item").forEach((t=>{t.addEventListener("mouseenter",(()=>{t.style.transform="translateY(-8px)"})),t.addEventListener("mouseleave",(()=>{t.style.transform="translateY(-3px)"}))}))},getStepIndexByName:function(t){for(let e=0;e<this.steps.length;e++)if(this.steps[e].getAttribute("data-step")===t)return e;const e={welcome:0,features:1,integration:2,finish:3};return t in e?e[t]:-1},getCompletedStepIndex:function(){return this.currentStep},goToStep:function(t){t>=0&&t<this.steps.length&&(this.currentStep=t,this.showStep(this.currentStep),this.updateProgress(this.currentStep))},pluginSliderCheckbox:function(e){const s=[];t(e).serialize().split("&").forEach((t=>{const[e,i]=t.split("=");if(e.startsWith("plugins")&&"on"===i){const t=decodeURIComponent(e.split("%5B%5D")[1]);t&&s.push(t)}})),s.length?t("#ep-install-plugins-btn").removeClass("d-none").addClass("pulse-animation"):t("#ep-install-plugins-btn").addClass("d-none").removeClass("pulse-animation")},onChangedPluginSliderCheckbox:function(){const e=this;t("#ep-install-plugins").on("change",".plugin-slider-checkbox",(function(s){e.pluginSliderCheckbox("#ep-install-plugins .plugin-slider-checkbox");const i=t(this).closest(".plugin-item");i.addClass("item-highlight"),setTimeout((()=>{i.removeClass("item-highlight")}),600)}))},showStep:function(t){this.steps.forEach((t=>{t.classList.remove("active"),t.style.display="none"}));const e=this.steps[t];e&&(e.classList.add("active"),e.style.display="block"),this.pluginSliderCheckbox("#ep-install-plugins .plugin-slider-checkbox")},filterItemsByType:function(t){document.querySelectorAll(".feature-item, .plugin-item").forEach((e=>{"all"===t||e.dataset.type===t?(e.style.display="flex",setTimeout((()=>{e.style.opacity="1",e.style.transform="translateY(0)"}),50)):(e.style.opacity="0",e.style.transform="translateY(10px)",setTimeout((()=>{e.style.display="none"}),300))}))},filterWidgets:function(){const t=this.categorySelect.value;this.widgetList.querySelectorAll("li").forEach((e=>{const s=e.dataset.type.split(/\s+/);"all"===t||s.includes(t)?(e.style.display="block",setTimeout((()=>{e.style.opacity="1",e.style.transform="translateY(0)"}),50)):(e.style.opacity="0",e.style.transform="translateY(10px)",setTimeout((()=>{e.style.display="none"}),300))}))},updateProgress:function(t){this.progressItems.forEach(((e,s)=>{s<t?(e.classList.remove("active"),e.classList.add("completed")):s===t?(e.classList.add("active"),e.classList.remove("completed")):e.classList.remove("active","completed")}))},searchWidgets:function(){const t=this.searchInput.value.toLowerCase();this.widgetList.querySelectorAll("li").forEach((e=>{e.dataset.label.toLowerCase().includes(t)?(e.style.display="block",setTimeout((()=>{e.style.opacity="1"}),50)):(e.style.opacity="0",setTimeout((()=>{e.style.display="none"}),300))}))},activateAllWidgets:function(t){t.preventDefault();const e=this.widgetList.querySelectorAll('input[type="checkbox"]');this.activateAllButton.classList.add("button-pulse"),setTimeout((()=>{this.activateAllButton.classList.remove("button-pulse")}),500),e.forEach((t=>{t.checked=!0;const e=t.closest("li");e.classList.add("item-highlight"),setTimeout((()=>{e.classList.remove("item-highlight")}),600)}))},deactivateAllWidgets:function(t){t.preventDefault();const e=this.widgetList.querySelectorAll('input[type="checkbox"]');this.deactivateAllButton.classList.add("button-pulse"),setTimeout((()=>{this.deactivateAllButton.classList.remove("button-pulse")}),500),e.forEach((t=>{t.checked=!1;const e=t.closest("li");e.classList.add("item-highlight"),setTimeout((()=>{e.classList.remove("item-highlight")}),600)}))},saveSettingsSubmit:function(){const e=this;t("#ep_setup_wizard_modules").submit((function(s){s.preventDefault();var i=t(this).serialize();const n=t(this).find("#save-and-continue"),a=n.html().trim();n.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...'),t.ajax({url:BDT_SetupWizard.ajax_url,type:"POST",data:i,success:function(t){t.success?(n.html('<i class="dashicons dashicons-yes-alt"></i> Saved!'),setTimeout((()=>{e.goToStep(e.currentStep+1),n.prop("disabled",!1).html(a)}),1e3)):(n.html('<i class="dashicons dashicons-no"></i> Failed'),setTimeout((()=>{n.prop("disabled",!1).html(a)}),1e3),alert("Failed to save settings"))},error:function(t){n.html('<i class="dashicons dashicons-no"></i> Error'),setTimeout((()=>{n.prop("disabled",!1).html(a)}),1e3),console.error("Error:",t)}})}))},installPlugins:function(){const e=this;t("#ep-install-plugins").submit((function(s){s.preventDefault(),e.installButton.disabled=!0,e.installButton.innerHTML='<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Installing...';const i=[];t(this).serialize().split("&").forEach((t=>{const[e,s]=t.split("=");if(e.startsWith("plugins")&&"on"===s){const t=decodeURIComponent(e.split("%5B%5D")[1]);t&&i.push(t)}}));let n=0;const a=i.length;let o=document.querySelector(".install-progress-container");o||(o=document.createElement("div"),o.className="install-progress-container",o.innerHTML='\n                            <div class="progress-bar-wrapper">\n                                <div id="plugin-install-progress" class="progress-bar" style="width: 0%">0%</div>\n                            </div>\n                            <div class="install-status">Preparing to install plugins...</div>\n                        ',e.installButton.parentNode.appendChild(o));const l=document.getElementById("plugin-install-progress"),r=document.querySelector(".install-status"),d=()=>{const t=n/a*100;l.style.width=`${t}%`,l.textContent=`${Math.round(t)}%`,r.textContent=`Installing plugin ${n} of ${a}...`},p=()=>{if(n<a){const t=i[n],e=t.split("/")[0].split("-").map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join(" ");r.textContent=`Installing ${e}...`,jQuery.ajax({url:BDT_SetupWizard.ajax_url,method:"POST",data:{action:"setup_wizard_install_plugins",nonce:BDT_SetupWizard.nonce,plugins:[t]},success:e=>{if(e.success){n++,d(),r.innerHTML+=' <span class="success-indicator"><i class="dashicons dashicons-yes-alt"></i></span>';const e=document.querySelector(`[data-slug="${t}"]`);e&&e.classList.add("plugin-installed"),setTimeout((()=>{p()}),500)}else r.innerHTML+=' <span class="error-indicator"><i class="dashicons dashicons-no"></i> Failed</span>',n++,d(),setTimeout((()=>{p()}),500)},error:t=>{r.innerHTML+=' <span class="error-indicator"><i class="dashicons dashicons-no"></i> Error</span>',n++,d(),setTimeout((()=>{p()}),500)}})}else r.textContent="All plugins installed successfully!",r.innerHTML+=' <span class="success-indicator"><i class="dashicons dashicons-yes-alt"></i></span>',setTimeout((()=>{e.installButton.disabled=!1,e.installButton.innerHTML="Installation Complete",e.goToStep(e.currentStep+1)}),1500)};p()}))}}).init()})),t("body").on("click",".ep-setup-wizard .template-import",(function(s){s.preventDefault(),s.stopPropagation();const i=t(this),n=i.closest(".choose-template"),a=n.data("import-url"),o=n.find(".template-title").text();if(!a)return void alert("Import URL not found");if(i.prop("disabled"))return;const l=i.html();i.prop("disabled",!0).html('<i class="dashicons dashicons-update"></i> Importing...'),n.addClass("template-importing"),n.find(".template-title").html(`<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Importing ${o}...`);const r=n.hasClass("bdt-ep-import-temp-zip");n.hasClass("bdt-ep-import-temp-json")?t.ajax({url:BDT_SetupWizard.ajax_url,type:"POST",data:{action:"import_elementor_template",nonce:BDT_SetupWizard.nonce,import_url:a},success:function(t){t.success?(i.removeClass("template-importing").addClass("template-imported").html('<i class="dashicons dashicons-yes-alt"></i> Imported'),n.removeClass("template-importing").addClass("template-imported"),n.find(".template-title").html(`<i class="dashicons dashicons-yes-alt"></i> ${o} Imported`)):(i.removeClass("template-importing").addClass("template-import-failed").html('<i class="dashicons dashicons-no"></i> Failed'),n.removeClass("template-importing").addClass("template-import-failed"),n.find(".template-title").html('<i class="dashicons dashicons-no"></i> Import Failed'),setTimeout((()=>{i.prop("disabled",!1).removeClass("template-import-failed").html(l)}),3e3))},error:function(){i.removeClass("template-importing").addClass("template-import-failed").html('<i class="dashicons dashicons-no"></i> Failed'),n.removeClass("template-importing").addClass("template-import-failed"),n.find(".template-title").html('<i class="dashicons dashicons-no"></i> Import Failed'),setTimeout((()=>{i.prop("disabled",!1).removeClass("template-import-failed").html(l)}),3e3)}}):r?t.ajax({url:BDT_SetupWizard.ajax_url,type:"POST",data:{action:"import_ep_elementor_bundle_template",nonce:BDT_SetupWizard.nonce,import_url:a},success:async function(t){if(t.success){const s=t.data.session,a=t?.data?.runners;let r="";for(const t of a){if(!await e(s,t)){r=`‚ùå Failed to import: ${t}`;break}}if(r)return i.removeClass("template-importing").addClass("template-import-failed").html('<i class="dashicons dashicons-no"></i> Failed'),n.removeClass("template-importing").addClass("template-import-failed"),n.find(".template-title").html(`<i class="dashicons dashicons-no"></i> ${r}`),alert(r),void setTimeout((()=>{i.prop("disabled",!1).removeClass("template-import-failed").html(l)}),3e3);i.removeClass("template-importing").addClass("template-imported").html('<i class="dashicons dashicons-yes-alt"></i> Imported'),n.removeClass("template-importing").addClass("template-imported"),n.find(".template-title").html(`<i class="dashicons dashicons-yes-alt"></i> ${o} Imported`)}else{i.removeClass("template-importing").addClass("template-import-failed").html('<i class="dashicons dashicons-no"></i> Failed'),n.removeClass("template-importing").addClass("template-import-failed");const e=t?.data?.plugins;if(e){let t=[];for(const s of e)t.push(s.name);n.find(".template-title").html('<i class="dashicons dashicons-no"></i> '+("plugins are required to import: "+t.join(", ")))}else n.find(".template-title").html(`<i class="dashicons dashicons-no"></i> ${t.data.message}`);setTimeout((()=>{i.prop("disabled",!1).removeClass("template-import-failed").html(l)}),3e3)}},error:function(){i.removeClass("template-importing").addClass("template-import-failed").html('<i class="dashicons dashicons-no"></i> Failed'),n.removeClass("template-importing").addClass("template-import-failed"),n.find(".template-title").html('<i class="dashicons dashicons-no"></i> Import Failed'),setTimeout((()=>{i.prop("disabled",!1).removeClass("template-import-failed").html(l)}),3e3)}}):(alert("Unsupported template format"),i.prop("disabled",!1).html(l),n.removeClass("template-importing"))})))}(jQuery),document.addEventListener("DOMContentLoaded",(function(){const t=document.createElement("style");t.textContent="\n        .bdt-wizard-step {\n            transition: opacity 0.3s ease, transform 0.3s ease;\n            display: none; /* Hide all steps by default */\n        }\n        \n        .bdt-wizard-step.active {\n            display: block; /* Show only active step */\n            opacity: 1;\n            transform: translateY(0);\n        }\n        \n        .item-highlight {\n            transition: all 0.3s ease;\n            box-shadow: 0 0 0 2px var(--ep-primary);\n            transform: translateY(-3px);\n        }\n        \n        .button-pulse {\n            animation: buttonPulse 0.5s ease;\n        }\n        \n        .pulse-animation {\n            animation: pulse 1.5s infinite;\n        }\n        \n        /* Spinner for plugin installation and template importing */\n        .spinner {\n            display: inline-block;\n            width: 16px;\n            height: 16px;\n            border: 2px solid rgba(255,255,255,0.3);\n            border-radius: 50%;\n            border-top-color: #fff;\n            animation: spin 1s linear infinite;\n            margin-right: 8px;\n        }\n        \n        /* Plugin installation progress styles */\n        .install-progress-container {\n            margin-top: 20px;\n            padding: 15px;\n            background: var(--ep-gray-light);\n            border-radius: var(--ep-border-radius);\n        }\n        \n        .progress-bar-wrapper {\n            height: 8px;\n            background: var(--ep-gray-medium);\n            border-radius: 4px;\n            overflow: hidden;\n            margin-bottom: 10px;\n        }\n        \n        .progress-bar {\n            height: 100%;\n            background: var(--ep-primary);\n            border-radius: 4px;\n            transition: width 0.3s ease;\n            color: transparent;\n            font-size: 0;\n        }\n        \n        .install-status {\n            font-size: 14px;\n            color: var(--ep-text-light);\n        }\n        \n        .success-indicator {\n            color: var(--ep-success);\n        }\n        \n        .error-indicator {\n            color: var(--ep-danger);\n        }\n        \n        .plugin-installed {\n            border-color: var(--ep-success) !important;\n        }\n        \n        /* Template import states */\n        .template-importing {\n            opacity: 0.7;\n            pointer-events: none;\n        }\n        \n        .template-imported {\n            border-color: var(--ep-success) !important;\n        }\n        \n        .template-import-failed {\n            border-color: var(--ep-danger) !important;\n        }\n        \n        /* Template import button states */\n        .template-import:disabled {\n            cursor: not-allowed;\n        }\n        \n        .template-import.template-imported {\n            background-color: #28a745;\n            border-color: #28a745;\n            color: white;\n        }\n        \n        .template-import.template-import-failed {\n            background-color: #dc3545;\n            border-color: #dc3545;\n            color: white;\n        }\n        \n        /* Animations */\n        @keyframes buttonPulse {\n            0%, 100% { transform: scale(1); }\n            50% { transform: scale(1.05); }\n        }\n        \n        @keyframes pulse {\n            0% { box-shadow: 0 0 0 0 rgba(108, 92, 231, 0.4); }\n            70% { box-shadow: 0 0 0 10px rgba(108, 92, 231, 0); }\n            100% { box-shadow: 0 0 0 0 rgba(108, 92, 231, 0); }\n        }\n        \n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n    ",document.head.appendChild(t)}));